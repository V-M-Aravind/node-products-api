<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/product.css">
    <title>Add Product</title>
</head>

<body>
    <%- include('includes/header'); -%>

        <main>
            <form class="product-form" method="POST" id="product-form" onsubmit="onAddProduct(event)">
                <div class="form-control">
                    <p id="notification" class="notification hidden"></p>
                    <label for="title">Title</label>
                    <input type="text" name="title" id="title" required>
                    <label for="price">Price</label>
                    <input type="number" name="price" id="price" step=".01" required>
                    <label for="qty">Quantity</label>
                    <input type="number" name="qty" id="qty" required>
                    <label for="imgUrl">Image Url</label>
                    <input type="text" name="imgUrl" id="imgUrl" required>
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" cols="50" required></textarea>
                </div>
                <button type="submit">Add Product</button>
            </form>
        </main>
        <script>
            function onAddProduct(e) {
                e.preventDefault();
                const title = document.getElementById("title").value;
                const qty = document.getElementById("qty").value;
                const price = document.getElementById("price").value;
                const imgUrl = document.getElementById("imgUrl").value;
                const description = document.getElementById("description").value;
                fetch("/admin/products", {
                    method: "POST", headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ title, qty, price, imgUrl, description }),
                }).then(response =>
                    response.json().then(data => ({ "status": response.status, "ok": response.ok, data }))
                ).then(result => {
                    const notificationEl = document.getElementById("notification");
                    if (!result.ok) {
                        notificationEl.textContent = `Oops.. Something went wrong!`;
                        notificationEl.classList.add("error");
                        notificationEl.classList.remove("hidden");
                        return;

                    }
                    console.log(result.data);
                    notificationEl.textContent = `Product added successfully with id ${result.data.id}`;
                    notificationEl.classList.add("success");
                    notificationEl.classList.remove("hidden");

                    document.getElementById("product-form").reset();
                }).catch(e => { console.error(e) })
            }
        </script>
</body>

</html>